"use strict";var car=function(){var l=document.querySelector(".tbox"),r=(document.querySelector(".shop-null"),document.querySelector(".empty")),c=document.querySelector("table"),i=document.querySelector(".page-main>.con"),a=document.querySelector(".sum"),f=document.querySelector(".shop_sum"),s=document.querySelector(".confirm"),d=document.querySelector(".close"),p=document.querySelector(".cover"),m=document.querySelector(".box"),n=document.querySelector(".title"),o=document.querySelector("#check1"),u=document.querySelector(".sum_count"),y=document.querySelectorAll(".add_car"),h=document.querySelectorAll(".car_list li"),g=document.querySelector(".car_more"),S=document.querySelector(".sure"),v=[],x=[],q=0;return{init:function(){this.event(),this.getData()},event:function(){var u=this;l.onclick=function(e){for(var t=document.querySelectorAll(".btn-del"),n=JSON.parse(localStorage.shops),o=(e=e||window.event()).target||e.srcElement,l=0;l<t.length;l++)t[l].index=l;"btn-del"==o.className&&(p.style.display="block",S.innerHTML="您确定删除该商品吗？",s.innerHTML="确定",s.onclick=function(){n.splice(o.parentNode.firstChild.index,1);localStorage.shops=JSON.stringify(n),p.style.display="none",m.style.left=window.innerWidth/2-m.offsetWidth+"px",m.style.top=window.innerHeight/2-m.offsetHeight+"px",location.href="car.html"},d.onclick=function(){p.style.display="none",m.style.left=window.innerWidth/2-m.offsetWidth+"px",m.style.top=window.innerHeight/2-m.offsetHeight+"px"})},n.onmousedown=function(e){var i=(e=e||window.event).offsetX,a=e.offsetY;document.onmousemove=function(e){var t=(e=e||window.event).pageX,n=e.pageY,o=parseInt(u.getStyle(m,"margin-left")),l=parseInt(u.getStyle(m,"margin-top")),r=window.innerWidth-m.offsetWidth/2,c=window.innerHeight-m.offsetHeight/2;n=n-a-l,(t=t-i-o)<m.offsetWidth/2?t=m.offsetWidth/2:r<t&&(t=r),n<m.offsetHeight/2?n=m.offsetHeight/2:c<n&&(n=c),m.style.left=t+"px",m.style.top=n+"px"}},document.onmouseup=function(){document.onmousemove=null},l.addEventListener("click",function(e){var t=(e=e||window.event).target;if("jian"==t.className){for(var n=JSON.parse(localStorage.shops),o=document.querySelectorAll(".jian"),l=0;l<o.length;l++)o[l].index=l;n[t.index].num;var r=document.querySelectorAll(".inp_v"),c=document.querySelectorAll(".xj");r[t.index].value--,n[t.index].num--,localStorage.shops=JSON.stringify(n),r[t.index].value<=1&&(r[t.index].value=1,n[t.index].num=1,localStorage.shops=JSON.stringify(n));var i=n[t.index].prcie.split("￥")[1],a=r[t.index].value*i;c[t.index].innerHTML="￥"+a;for(var u=0,s=[],d=0;d<c.length;d++)s.push(c[d].innerHTML.split("￥")[1]);s.forEach(function(e,t){return u+=Number(e)}),f.innerHTML=u}else if("jia"==t.className){for(n=JSON.parse(localStorage.shops),o=document.querySelectorAll(".jia"),l=0;l<o.length;l++)o[l].index=l;r=document.querySelectorAll(".inp_v"),c=document.querySelectorAll(".xj");r[t.index].value++,10<=r[t.index].value&&(r[t.index].value=10,n[t.index].num=10,localStorage.shops=JSON.stringify(n));i=n[t.index].prcie.split("￥")[1];n[t.index].num++,localStorage.shops=JSON.stringify(n);a=r[t.index].value*i;c[t.index].innerHTML="￥"+a;for(u=0,s=[],d=0;d<c.length;d++)s.push(c[d].innerHTML.split("￥")[1]);s.forEach(function(e,t){return u+=Number(e)}),f.innerHTML=u}}),o.onclick=function(){var e=document.querySelectorAll(".Checkbox");if(1==o.checked)for(var t=0;t<e.length;t++)e[t].checked=!0;else for(t=0;t<e.length;t++)e[t].checked=!1};for(var e=function(e){h[e].onmouseenter=function(){y[e].style.display="block"},h[e].onmouseleave=function(){y[e].style.display="none"}},t=0;t<h.length;t++)e(t);g.onclick=function(e){var t=(e=e||window.event).target||e.srcElement;if(e.preventDefault(),"add_car"==t.className){e.preventDefault();for(var n=document.querySelectorAll(".car_img"),o=document.querySelectorAll(".sj_name"),l=document.querySelectorAll(".sj_price"),r=0;r<y.length;r++)y[r].index=r;var c=n[t.index].src,i=o[t.index].innerHTML,a={shopname:i,prcie:l[t.index].innerHTML,num:1,shop_img:c};u.judge("shops","shopname",i,function(e){0==e?(p.style.display="block",S.innerHTML="该商品已在购物车等候亲了",s.innerHTML="购物车查看",s.onclick=function(){location.href="car.html"},d.onclick=function(){p.style.display="none"}):1==e&&u.add("shops",a,function(){location.href="car.html"})})}}},getData:function(){if("[]"!=localStorage.shops&&localStorage.shops){r.style.display="none";for(var e=JSON.parse(localStorage.shops),t=0;t<e.length;t++){v.push('<tr>\n\t\t\t\t\t\t        <td><input type="checkbox" class="Checkbox" id="check1">\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td><img src="'.concat(e[t].shop_img,'"/></td>\n\t\t\t\t\t\t\t\t<td>').concat(e[t].shopname,"</td>\n\t\t\t\t\t\t\t\t<td>").concat(e[t].prcie,'</td>\n\t\t\t\t\t\t\t\t<td><a class=\'jian\'>-</a><input type="text" value="').concat(e[t].num,"\" class='inp_v'/><a class='jia'>+</a></td>\n\t\t\t\t\t\t\t\t<td class='xj'>").concat(e[t].prcie,'</td>\n\t\t\t\t\t\t\t\t<td><button class="btn-del">删除</button></td>\n\t\t\t\t\t\t\t</tr>'));var n=e[t].prcie.substr(1);n=Number(n)*Number(e[t].num),x.push(n)}x.forEach(function(e,t,n){return q+=Number(e)});var o=e.length;u.innerHTML=o,f.innerHTML=q,l.innerHTML=v.join("")}else i.style.background="#f5f5f5",c.style.display="none",a.style.display="none",r.style.display="block",g.style.display="none"},getStyle:function(e,t){if(window.getComputedStyle)return window.getComputedStyle(e,null)[t];obj.currentStyle[v]},add:function(e,t,n){var o=null;(o=localStorage[e]?JSON.parse(localStorage[e]):[]).push(t),localStorage[e]=JSON.stringify(o),n&&n()},judge:function(e,t,n,o){if(localStorage[e]){for(var l=JSON.parse(localStorage[e]),r=!1,c=0;c<l.length;c++)l[c][t]===n&&(r=!0);o(r?0:1)}else o(1)}}}();car.init(),window.onload=function(){for(var e=document.querySelectorAll(".xj"),t=document.querySelectorAll(".inp_v"),n=0;n<e.length;n++)e[n].innerHTML="￥"+Number(e[n].innerHTML.split("￥")[1])*Number(t[n].value)};